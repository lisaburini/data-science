version: "3.1"

rules:

- rule: Start conversation
  steps:
  - intent: start
  - action: utter_start

#- rule: Say goodbye anytime the user says goodbye
#  steps:
#  - intent: goodbye
#  - action: utter_goodbye
#  - action: ask_suggestion_form
#  - active_loop: ask_suggestion_form
  # - action: action_restart

- rule: Say 'I am a bot' anytime the user challenges
  steps:
  - intent: bot_challenge
  - action: utter_iamabot

- rule: Say 'Mi dispiace, spiegami meglio come posso esserti utile' anytime the user is sad
  steps:
  - intent: mood_unhappy
  - action: utter_mood_unhappy

- rule: Apologise anytime the user is angry
  steps:
  - intent: attack
  - action: utter_attack


- rule: Bot is happy that the user is satisfied
  steps:
  - intent: mood_great
  - action: utter_mood_great


- rule: submitOK
  steps:
  - intent: submit
  - action: utter_submit

- rule: submitNO
  steps:
  - intent: not_submit
  - action: utter_not_submit

- rule: specify the domain of the bot
  steps:
  - intent: out_of_scope
  - action: utter_out_of_scope



# rules for form to ask report id

- rule: Activate form report id
  steps:
  - intent: check_status_report
  # - action: utter_ask_report_id
  - action: check_status_form
  - active_loop: check_status_form

- rule: Submit form
  condition:
  - active_loop: check_status_form
  steps:
  - action: check_status_form
  - active_loop: null
  - slot_was_set:
    - requested_slot: null
  # - action: utter_confirm_id
  - action: check_status_db
  - action: utter_ask_other


# rule for fallback
- rule: Ask to rephrase
  steps:
  - intent: nlu_fallback
  - action: utter_out_of_scope

# rule to get office info
- rule: Activate form office info
  steps:
  - intent: office_info
  # - action: utter_ask_office
  - action: office_info_form
  - active_loop: office_info_form

- rule: Submit form
  condition:
  - active_loop: office_info_form
  steps:
  - action: office_info_form
  - active_loop: null
  - slot_was_set:
    - requested_slot: null
  # wait_for_user_input: false
  - action: get_office_info
  # - action: get_employees_info
  - action: utter_ask_other

# rule to get specific office info
- rule: get specific office info
  steps:
  - intent: specific_office_info
    entities:
    - entity_name: specific_area
  - action: get_specific_office_info
  - action: utter_ask_other

# rule to get employee info
- rule: Activate form employee info
  steps:
  - intent: employees_info
  # - action: utter_ask_office
  - action: employee_info_form
  - active_loop: employee_info_form

- rule: Submit form employee info
  condition:
  - active_loop: employee_info_form
  steps:
  - action: employee_info_form
  - active_loop: null
  - slot_was_set:
    - requested_slot: null
  # wait_for_user_input: false
  - action: get_employees_info
  # - action: get_employees_info
  - action: utter_ask_other



- rule: start report
  steps:
  - intent: insert_report
  - action: insert_info_in_report
  - active_loop: insert_info_in_report

- rule: compile report
  steps:
  - intent: insert_report
  #- action: utter_ask_description
  - action: insert_info_in_report
  - active_loop: insert_info_in_report
  - slot_was_set:
    - requested_slot: description
 # - action: utter_location
  - slot_was_set:
    - requested_slot: location
#  - action: utter_full_name
  - slot_was_set:
    - requested_slot: full_name
 # - action: utter_phone_number
  - slot_was_set:
    - requested_slot: phone_number
 # - action: utter_email
  - slot_was_set:
    - requested_slot: email
  - active_loop: null
  - action: utter_ask_confirm


# buttons to continue for suggestion insert (yes/no)
- rule: ask to insert a suggestion
  steps:
  # - action: utter_ask_confirm_button
  - intent: goodbye
  - action: utter_goodbye
  - action: ask_suggestion_form
  - active_loop: ask_suggestion_form

- rule: Submit form ask to insert a suggestion
  condition:
  - active_loop: ask_suggestion_form
  steps:
  - action: ask_suggestion_form
  - active_loop: null
  - slot_was_set:
    - requested_slot: null
  # wait_for_user_input: false
  - action: fill_slot
  - action: insert_suggestion
#- rule: insert a suggestion
#  steps:
  #- intent: suggestion_proposal
  #- action: utter_ask_suggestion
#  - action: insert_suggestion
  - active_loop: insert_suggestion
  - slot_was_set:
    - requested_slot: suggestion
#  - action: utter_full_name
  - slot_was_set:
    - requested_slot: full_name
 # - action: utter_phone_number
  - slot_was_set:
    - requested_slot: phone_number
 # - action: utter_email
  - slot_was_set:
    - requested_slot: email
  - active_loop: null
  - action: submit_suggestion
  - action: action_restart


- rule: submitOK
  condition:
  - active_loop: insert_info_in_report
  steps:
    - action: insert_info_in_report
    - active_loop: null
    - slot_was_set:
      - requested_slot: null
    - action: utter_ask_confirm
    - intent: submit
    - action: submit_report


- rule: submitNO
  steps:
    - intent: not_submit
    - action: utter_not_submit
